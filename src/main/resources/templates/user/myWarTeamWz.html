<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>个人中心-我的战队</title>
	<link rel="stylesheet" href="/css/main.css">
	<link rel="stylesheet" href="/css/personal.css">
	<script src="/js/jquery.1.11.3.min.js"></script>
	<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</head>
<body>
<div class="topWrap">
	<div th:include="/include :: topWrap" ></div>
</div>
<div class="data">
	<div class="content">
		<div class="tit">个人中心</div>
		<div class="cont">
			<div class="lt">
				<ul>
					<li><a href="/user/index"><div class="ic ic1"></div><span>我的资料</span></a></li>
					<li><a href="/user/myMatch"><div class="ic ic2"></div><span>我的赛事</span></a></li>
					<li><a href="/user/BetOrder" ><div class="ic ic3"></div><span>我的竞猜</span></a></li>
					<li><a href="#"><div class="ic ic4"></div><span>兑换商城</span></a></li>
					<li><a href="/user/ConvertDiamondToGold"><div class="ic ic5"></div><span>货币兑换</span></a></li>
					<li><a href="/user/PersonalWealth" class="select"><div class="ic ic6"></div><span>消费记录</span></a></li>
					<li><a href="/user/UserHonor"><div class="ic ic7"></div><span>个人荣誉</span></a></li>
					<li><a  href="/user/myWarTeam"><div class="ic ic9"></div><span>我的战队</span></a></li>
				</ul>
			</div>
			<div class="team">
				<!--创建战队-->
				<div class="dialog" style="display: none;">
					<div class="contuwrap" >
						<div class="pubclose">
							<img src="/images/closeico.png" onclick="closeWin('')">
						</div>
						<div class="cont">

							<div class="upimg">
								<span>上传战队图片</span>
								<a href="javascript:;" class="file right">
									<input type="file" name="" id="">
								</a>
							</div>
							<div class="info1">
								<p class="clearfix"><span>所属游戏</span>
									<select class="right" id="gameType">
										<option value="1">王者荣耀</option>
										<option value="2">绝地求生</option>
									</select>
								</p>
								<p class="clearfix"><span>游戏区服</span>
									<select class="right" id="serverType">
										<option value="1">手游区</option>
										<option value="2">微信区</option>
									</select>
								</p>
								<p class="clearfix"><span>战队名称</span><input type="text" placeholder="最多6个字且不支持符号" maxlength="6" id="troopsName"></p>
								<p class="clearfix bor-botttom11"><span>战队宣言</span><input type="text" placeholder="最多25字" maxlength="25"></p>
							</div>
							<div class="info1">
								<p class="clearfix"><span>真实姓名</span><input type="text" placeholder="请输入真实姓名"></p>
								<p class="clearfix"><span>身份证号</span><input type="text" placeholder="请输入身份证号"></p>
								<p class="clearfix"><span>验证手机号</span><input type="text" placeholder="请输入手机号" id="phoneInput"></p>
								<p class="clearfix"><span>输入验证码 </span>
									<span class="access" style="cursor:pointer;" onclick="getCode()">获取</span>
									<!--<span id="getCodeBtn" class="bg-red" style="cursor:pointer;">获取验证码</span>-->
									<input type="text" placeholder="请输入验证码" id="code"></p>
								<div class="craat-btn" onclick="createTeam()" style="cursor:pointer;">创建战队</div>
								<div class="agreement">创建战队即代表同意<em>《创建战队协议》</em></div>
							</div>
						</div>
					</div>
				</div>
				<div class="table_head overflow_hide color-glod">
                    <div class="left fl">
                        <label  class="active" name="wz">王者荣耀</label>
                        <label name="jd">绝地求生大逃杀</label>
                    </div>
                        <div class="right fr messd">
                            <label id="create" class="active" style="display: none;" onclick="createTeam1()"><span>创建战队</span></label>
							<i class="playapply" onclick="poprdsq()" style="cursor:pointer;">入队申请<span class="news"></span></i>
                            <div class="messa"><i> <img src="/images/messico.png"> </i><span class="mdat"></span></div>
                        </div>
				</div>
				<div class="list my" id="teamInfo">

				</div>
            <div  style="display: block;" id="wz">
				<div class="table_box show">
					<ul class="tabs clearfix" style="display: block;">
						<li class="active"><a href="#tab1">战队荣誉</a></li>
						<li><a href="#tab2">战队成员</a></li>
						<li><a href="#tab3">历史赛事</a></li>
					</ul>
				</div>
				<div id="tab1" class="tab_content" style="display: block; ">
					<div id="tabNo1">
					</div>
					<div class="z_pager">
						<ul id="pageContainer1"></ul>
					</div>
				</div>
				<div id="tab2" class="tab_content" style="display: none; ">
					<div id="tabNo2">
					</div>
					<div class="z_pager">
						<ul id="pageContainer2"></ul>
					</div>
				</div>
				<div id="tab3" class="tab_content" style="display: none; ">
					<div id="tabNo3">
					</div>
					<div class="z_pager">
						<ul id="pageContainer3"></ul>
					</div>
				</div>
			</div>
			<div class="historyTable">
				<div class="list" id="teamList">
				</div>
                <div class="z_pager">
                    <ul id="pageContainer"></ul>
                </div>
            </div>
			</div>
		</div>
	</div>
</div>
<div class="botwrap">
	<div th:include="/include :: botwrap"></div>
	<textarea id="teamInfoArea"  style="display:none;">
	{{each troops}}
						<div class="block1">
						<img src="{{$value.troopsUrl}}" style="width: 46px;height: 49px;">
						<p>{{$value.troopsName}}</p>
					</div>
					<div class="block2">
						<p>{{$value.troopsManifesto}}</p>
						<div class="info">
                                        {{if ($value.gameType==1 )}}
	                                        <span>王者荣耀</span>
	                                    {{else if(($value.gameType==2))}}
	                                        <span>绝地求生</span>
	                                    {{/if}}

                                        {{if ($value.serverType==1 )}}
	                                        <span>手游区</span>
	                                    {{else if(($value.gameType==2))}}
	                                        <span>微信区</span>
	                                    {{/if}}
                                        <span>{{$value.troopsNumbers}}/{{$value.troopsNumberLimit}}</span></div>
					</div>
					<div id="exitzdd" class="zd-btn" onclick="tuchuTeam()" style="cursor:pointer;">退出战队</div>
    {{/each}}
	</textarea>
	<textarea id="itemTemplate"  style="display:none;">
	{{each result}}
						<div class="table_box show">
							<div class="list">
								<div class="block1">
									<img src="{{$value.troopsUrl}}" style="width: 46px;height: 49px;">
									<p>{{$value.troopsName}}</p>
								</div>
								<div class="block2">
									<p>{{$value.troopsManifesto}}</p>
									<div class="info">
                                        {{if ($value.gameType==1 )}}
	                                        <span>王者荣耀</span>
	                                    {{else if(($value.gameType==2))}}
	                                        <span>绝地求生</span>
	                                    {{/if}}

                                        {{if ($value.serverType==1 )}}
	                                        <span>手游区</span>
	                                    {{else if(($value.gameType==2))}}
	                                        <span>微信区</span>
	                                    {{/if}}
                                        <span>{{$value.troopsNumbers}}/{{$value.troopsNumberLimit}}</span></div>
								</div>
								<div class="zd-btn"  style="cursor:pointer;" onclick="goTeamInfo({{$value.id}})">申请加入</div>
							</div>
                      </div>
    {{/each}}
	</textarea>
	<textarea id="teamHonor"  style="display:none;">
	{{each result}}
						<div class="saishi">
							<i><img src="{{$value.matchPic}}" style="width: 46px;height: 49px;"></i>
							<span class="text">{{$value.matchName}}</span>
							<em>
								{{if ($value.ranking == "冠军")}}
	                                        <img src="/images/rank1icon.png" alt="">冠军
	                            {{else if($value.ranking == "亚军")}}
	                                        <img src="/images/rank2icon.png" alt="">亚军
								{{else if($value.ranking == "亚军")}}
	                                        <img src="/images/rank3icon.png" alt="">亚军
								{{else}}
	                                        {{$value.ranking}}
	                             {{/if}}

							</em>
						</div>
    {{/each}}
	</textarea>
	<textarea id="teamHistory"  style="display:none;">
	{{each result}}
						<div class="saishi">
							<i><img src="{{$value.matchPic}}" style="width: 103px;height: 26px;">
							</i>
							<span class="text">{{$value.matchName}}</span>
						</div>
    {{/each}}
	</textarea>
	<textarea id="teamMember"  style="display:none;">
	{{each result}}
						<div class="players clearfix">
						<div class="captain"><img src="{{$value.headUrl}}"></div>
						<div class="id"><p class="name">APP ID：{{$value.idCard}}</p><p>游戏ID：{{$value.nickName}}</p></div>
						<div class="area">
										<!--{{if ($value.serverType==1 )}}
	                                        <span>手游区</span>
	                                    {{else if(($value.gameType==2))}}
	                                        <span>微信区</span>
	                                    {{/if}}-->
							 <span>{{$value.serverType}}</span>
						</div>
						<div class="dan">{{$value.level}}</div>
							{{if ($value.userId == captainId)}}
	                                        <div class="position">队长</div>
	                        {{/if}}
					</div>
    {{/each}}
	</textarea>
	<textarea id="teamnNewMember"  style="display:none;">
	{{each result}}
				<div class="captain"><img src="{{$value.headUrl}}"></div>
				<div class="id"><p class="name">APP ID：{{$value.idCard}}</p><p>游戏ID：{{$value.nickName}}</p></div>
				<div class="area">{{if ($value.serverType==1 )}}
	                                        <span>手游区</span>
	                                    {{else if(($value.gameType==2))}}
	                                        <span>微信区</span>
	                                    {{/if}}</div>
				<div class="dan">($value.level)</div>
				<div class="zd-btncz">
					<a class="tcdz" href="" >接受</a>
					<a class="zydz" href="">删除</a>
				</div>
    {{/each}}
	</textarea>
</div>
<!--我的战队-队员推出战队弹窗-->
<div class="exitzd" style="display: none;">
	<div class="blacbg">
	</div>
	<div class="alwr">
		<div class="pubclose">
			<img src="/images/closeico.png" onclick="closeWin('exitzd')">
		</div>
		<div class="credwrap">
			<h3>确定退出战队？
			</h3>
			<p>
				<a href="javascript:;" onclick="closeWin('exitzd')">取消</a>
				<a href="javascript:;" id="backTeam">确定</a>
			</p>
		</div>
	</div>
</div>

<!--我的战队入队申请-->
<div class="poprdsq">
	<div class="blacbg">
	</div>
	<div class="playerwr">
		<div class="pubclose">
			<img src="/images/closeico.png">
		</div>
		<div class="playerwrap">
			<h3>入队申请
			</h3>

			<div class="players clearfix" id="newMemberlist">

			</div>

			<div class="viewmatch">查看全部赛事 <img src="/images/viemat.png"></div>
		</div>
	</div>
</div>
<script  src="/vendor/sea/sea.js"></script>
<script src="/scripts/config/seajs-config.js"></script>
<script  type="text/javascript" src="/layer/layer.js"></script>
<script type="text/javascript">
	seajs.use('/scripts/controller/user/myWarTeamWz');
</script>
<script type="text/javascript" src="/js/jquery.select.js"></script>
<script type="text/javascript">
	$(".historyTable").hide();
	$(".tab_content").hide();
	$(".tab_content:first").show();
	$(".fenye a").click(function(){
        $(this).addClass("active").siblings().removeClass("active");
    })
	function createTeam1() {
		$(".dialog").fadeIn();
	}
	function poprdsq() {
		var isShow4=true;
		if(isShow4){
			isShow4=false;
		$("#newMemberlist").paginator({
			itemTemplateId : teamnNewMember,
			usepager:false,
			useSeniorTemplate:true,
			ajaxFuc : function(curentPage, renderHtml) {
				var p2 = {
					troopsId : troopsId
				};

				$.ajax({
					url : "/user/myWarTeam/newMemberlist",
					datatype : 'json',
					type : "get",
					data : p2,
					success : function(json) {
						var data = json.t;
						renderHtml(data);
						isShow=true;
					}
				});
			}
		});
		$(".poprdsq").fadeIn();
	}
	function createTeam() {
		var troopsName=$("#troopsName").val();
		var gameType=$("#gameType").val();
		var serverType=$("#serverType").val();
		var captainId="";
		var code=$("#code").val();
		var phone =$("#phoneInput").val();
		$.ajax({
			url : "/user/myWarTeam/editTeam",
			datatype : 'json',
			type : "get",
			data : {"troopsName" : troopsName,"gameType" : gameType,"serverType" : serverType,"code":code,"phone":phone},
			success : function(json) {
				var data = json.msg;
				layer.alert(data, {
							title: data,
							btn: ['确定']
						},
						function (index, item) {
							location.reload();
						});
			}
		});
	}
	function tuchuTeam() {
		$(".exitzd").show();
	}
	function closeWin(wid) {
		$("."+wid).hide();
	}
	function goTeamInfo(id) {
		var curWwwPath = window.document.location.href;
		//获取主机地址之后的目录，如： uimcardprj/share/meun.jsp
		var pathName = window.document.location.pathname;
		var pos = curWwwPath.indexOf(pathName);
		window.location.href=window.document.location.href.substring(0, pos)+'/user/warTeamInfo?id='+id;
	}
	function closeWin() {
		$('.dialog').fadeOut();
	}
	// 绑定获取验证码事件
	var InterValObj; //timer变量，控制时间
	var count = 90; //间隔函数，1秒执行
	//var curCount;//当前剩余秒数
	function getCode() {
		var mobile = $("#phoneInput").val();
		if (mobile == "") {
			layer.msg("请输入手机号");
			return;
		}
		if(!isPoneAvailable(mobile)){
			layer.msg("请输入正确的手机号");
			return;
		}
		//curCount = count;
		$(this).off("click");
		$(this).removeAttr("class","bg-red");
		$(this).attr("class","bg-999");
		//$(this).text("倒计时" + curCount + "秒");
		//InterValObj = window.setInterval(SetRemainTime, 1000); //启动计时器，1秒执行一次
		sendsms(mobile);
	};
	//发送验证码
	function sendsms(mobile){
		$.ajax({
			url : "/sendMobileCodeByCreatTeam",
			datatype : 'json',
			type : "post",
			data : {
				"mobile" : mobile
			},success:function(obj){
				if(obj==null){
					layer.msg("远程接口调用失败");
				}else{
					if(obj.code==200){
						layer.msg("验证码发送成功");
					}else{
						layer.msg("验证码发送失败请重试！");
					}
				}
			}
		});
	}
	//timer处理函数
	function SetRemainTime() {
		if (curCount == 0) {
			window.clearInterval(InterValObj);//停止计时器
			$("#getCodeBtn").on("click",function(){
				var mobile = $("#phoneInput").val();
				if (mobile == "") {
					layer.msg("请输入手机号");
					return;
				}
				if(!isPoneAvailable(mobile)){
					layer.msg("请输入正确的手机号");return;}
				curCount = count;
				//设置button效果，开始计时
				$(this).off("click");
				$(this).removeAttr("class","bg-red");
				$(this).attr("class","bg-999");
				$(this).text("倒计时" + curCount + "秒");
				InterValObj = window.setInterval(SetRemainTime, 1000); //启动计时器，1秒执行一次
				sendsms(mobile);

			});
			$("#getCodeBtn").removeAttr("class","bg-999");
			$("#getCodeBtn").attr("class","bg-red");
			$("#getCodeBtn").text("发送验证码");

		}
		else {
			curCount--;
			$("#getCodeBtn").text("倒计时" + curCount + "秒");
		}
	}

	//验证手机号码
	function isPoneAvailable(poneInput) {
		var myreg=/^1[3|4|5|8][0-9]\d{4,8}$/;
		if (!myreg.test(poneInput)) {
			return false;
		} else {
			return true;
		}
	}
</script>
</body>
</html>